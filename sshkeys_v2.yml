--
- hosts: [octopus-webserver]
  vars:
    milos_ssh_key: "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCvSEVYNxA6hR3hPkRagWQC3qlbV+73BgVC5/o6+J+Lryq5UeMMNHJRARS3Ou6D9AQnG8U+3yuez9npDs7HPkMEdNLWfB6bFj+Poqv7O3HwBHRRgZ4xUWihOe9nSNEXPikJylxKlyCIYqrMl9uASUgzPPqvUmorxBS+lTh1yfg513YwOM0KmmSeX6Okkqik3O8udZGeHGADDss1RrG7lPFx8NulgwAz7cTpAEfljAdFnCI5OlxnhtdLfxmFiB3EdX5B9146UWVrHiGlPsmtwhpgJOcgqtGid1kCuDcMa63jV3uGUDbKedNVdQ9gqrvFmMvFPfSz30faTF4gbgfguzGnA+S4MTkBdPYY1kc/9UkFFrhUN2x4h7yzHqfyJ+4hBZj3mm66YwE0yj8fm8+lMzermJO4IZBfxhYfYAqjC/Lox2j+DF+Jw8Kk6MT/SBWuAxuJQRGInsdstKe7QN+NcGV4sCDsMUAWRGM2CsJsh4KbLH8lzrrxNysFeoqiTXf6aSU= milos@14C-DL-milos"
  tasks:
    - name: Check is ssh installed
      service: 
        name: sshd
        state: started
        enabled: yes
    
    - name: Check does file authorized_keys exists
      stat: 
        path: ~/.ssh/authorized_keys
      register: file_status
    
    - debug: 
        msg: "File already exists!"
      when: file_status.stat.exists

    - name: Create authorized_keys if it not exists
      file:
        path: ~/.ssh/authorized_keys
        state: touch
        mode: 0600
      when: file_status.stat.exists == false

    - name: Copy public SSH keys to authorized_keys 
      lineinfile:
        path: /home/ec2-user/.ssh/authorized_keys
        line: "{{ milos_ssh_key }}"
